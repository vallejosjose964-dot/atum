<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ATUM — THOT Engine (Micro + Macro)</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1020;
      --panel:#111a33;
      --line: rgba(255,255,255,.10);
      --text:#eaf0ff;
      --muted:#a9b6d6;
      --accent:#7dd3fc;
      --accent2:#c4b5fd;
      --ok:#22c55e;
      --bad:#ef4444;
      --r:16px;
      --shadow: 0 14px 40px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% 0%, rgba(125,211,252,.12), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(196,181,253,.10), transparent 60%),
        var(--bg);
    }

    header{
      position:sticky; top:0; z-index:20;
      background: rgba(11,16,32,.80);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }

    .wrap{ max-width:1200px; margin:0 auto; padding:14px 16px; }

    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; }

    .brand{ display:flex; align-items:center; gap:12px; min-width:0; }
    .mark{
      width:12px; height:12px; border-radius:6px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 18px rgba(125,211,252,.35);
      flex:0 0 auto;
    }
    .title{
      font-size:14px; font-weight:700; letter-spacing:.6px;
      margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .subtitle{ margin:2px 0 0; font-size:12px; color:var(--muted); }

    .status{
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
    }
    .dot{ width:10px; height:10px; border-radius:50%; background: rgba(255,255,255,.25); }
    .dot.ok{ background: var(--ok); }
    .dot.bad{ background: var(--bad); }

    main{ padding: 16px 0 34px; }

    .grid{ display:grid; grid-template-columns: 420px 1fr; gap:14px; }
    @media (max-width: 1000px){ .grid{ grid-template-columns:1fr; } }

    .card{
      border:1px solid var(--line);
      border-radius: var(--r);
      background: rgba(17,26,51,.70);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .hd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 12px 14px;
      background: rgba(255,255,255,.02);
      border-bottom:1px solid var(--line);
    }
    .hd h2{
      margin:0;
      font-size:12px;
      letter-spacing:.8px;
      color: rgba(234,240,255,.85);
      text-transform: uppercase;
    }

    .bd{ padding:14px; }

    .muted{ color: var(--muted); font-size:12px; }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .row.nowrap{ flex-wrap:nowrap; }
    .row.tight{ gap:8px; }

    .pillbar{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      border-color: rgba(125,211,252,.45);
      background: rgba(125,211,252,.10);
    }

    input[type="text"], select, button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      border-radius: 12px;
      padding: 9px 10px;
      font-size: 13px;
      outline:none;
    }
    input[type="text"], select{ width:100%; }
    button{ cursor:pointer; }
    button:hover{ background: rgba(255,255,255,.06); }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.45; cursor:not-allowed; }

    .primary{
      border-color: rgba(125,211,252,.45);
      background: rgba(125,211,252,.10);
    }

    .sectionTitle{ margin: 14px 0 8px; display:flex; justify-content:space-between; align-items:center; }

    .hint{
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius: 12px;
      padding: 10px;
      font-size:12px;
      color: var(--muted);
      line-height: 1.35;
    }
    .hint b{ color: rgba(234,240,255,.90); font-weight:600; }

    .log{
      height: 200px;
      overflow:auto;
      white-space: pre-wrap;
      font-size: 12px;
      border:1px solid var(--line);
      border-radius: 12px;
      padding: 10px;
      background: rgba(0,0,0,.22);
    }

    .canvasWrap{
      border:1px solid var(--line);
      border-radius: 14px;
      background: rgba(0,0,0,.20);
      padding: 10px;
    }
    canvas{ width:100%; height: 460px; display:block; }
    @media (max-width: 980px){
      canvas{ height: 360px; }
      .row.nowrap{ flex-wrap:wrap; }
    }

    table{
      width:100%;
      border-collapse: collapse;
      font-size:12px;
      border:1px solid var(--line);
      border-radius: 12px;
      overflow:hidden;
      background: rgba(255,255,255,.02);
    }
    th,td{
      padding:8px 8px;
      border-bottom:1px solid var(--line);
      text-align:left;
    }
    th{ color:var(--muted); font-weight:600; background: rgba(255,255,255,.03); }
    tr:last-child td{ border-bottom:none; }

    .macroGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 700px){ .macroGrid{ grid-template-columns: 1fr; } }

    .metric{
      border:1px solid var(--line);
      border-radius: 12px;
      padding:10px;
      background: rgba(255,255,255,.02);
    }
    .metric .k{ font-size:11px; color:var(--muted); }
    .metric .v{ margin-top:6px; font-size:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
      border-top: 1px solid var(--line);
      padding-top: 12px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="mark" aria-hidden="true"></div>
        <div style="min-width:0">
          <p class="title">ATUM — Micro + Macro</p>
          <p class="subtitle">Powered by THOT • Una sola constante • Sin perillas</p>
        </div>
      </div>

      <div class="status">
        <span class="dot" id="backendDot"></span>
        <span id="backendLabel" class="mono">Backend: no verificado</span>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="grid">

      <section class="card">
        <div class="hd">
          <h2>Control</h2>
          <div class="row tight">
            <button id="btnReset">Reset</button>
          </div>
        </div>

        <div class="bd">
          <div class="hint">
            <div><b>Flujo:</b> Ping → Load → Preview → Compute / Global RMS.</div>
            <div><b>Micro:</b> <span class="mono">/micro</span> • <b>Macro:</b> <span class="mono">/compute</span>, <span class="mono">/global_rms</span></div>
          </div>

          <div class="sectionTitle"><div class="muted">Modos</div></div>
          <div class="pillbar" aria-label="Modos">
            <button class="chip" id="btnW">W</button>
            <button class="chip" id="btnZ">Z</button>
            <button class="chip" id="btnMuon">MUON</button>
            <span style="flex:1 1 auto;"></span>
            <button class="chip active" id="btnGalaxies">Galaxias</button>
            <button class="chip" id="btnClusters">Clusters</button>
            <button class="chip" id="btnDwarfs">Enanas</button>
          </div>

          <div class="sectionTitle"><div class="muted">Backend</div></div>
          <div class="row">
            <input type="text" id="backendBase" value="https://thot-engine.onrender.com"/>
          </div>

          <div class="row nowrap tight" style="margin-top:10px;">
            <button id="btnPing" class="primary">Ping</button>
            <button id="btnLoadRepo" class="primary">Load</button>
            <button id="btnPreview">Preview</button>
            <button id="btnCompute" class="primary">Compute</button>
            <button id="btnGlobalRMS">Global RMS</button>
          </div>

          <div class="sectionTitle"><div class="muted">Dataset</div></div>
          <div class="row">
            <input type="text" id="repoZipUrl" value="./Rotmod_LTG.zip"/>
          </div>
          <div class="row" style="margin-top:10px;">
            <select id="fileSelect" disabled>
              <option value="">(sin dataset cargado)</option>
            </select>
          </div>

          
          <div class="sectionTitle"><div class="muted">Micro (salida)</div></div>
          <div class="macroGrid">
            <div class="metric"><div class="k">a_star (m/s²)</div><div class="v" id="microAStar">—</div></div>
            <div class="metric"><div class="k">tau (s)</div><div class="v" id="microTau">—</div></div>
            <div class="metric"><div class="k">mW (GeV)</div><div class="v" id="microMW">—</div></div>
            <div class="metric"><div class="k">delta_r</div><div class="v" id="microDelta">—</div></div>
            <div class="metric"><div class="k">eta_vci</div><div class="v" id="microEta">—</div></div>
            <div class="metric"><div class="k">lambda_eff</div><div class="v" id="microLambda">—</div></div>
            <div class="metric"><div class="k">status</div><div class="v" id="microStatus">—</div></div>
          </div>

          <div class="sectionTitle"><div class="muted">Log</div></div>
          <div id="log" class="log mono"></div>

          <div class="footer">
            © ATUM — Software propietario de Fabián Vallejos. Registrado en INPI (Argentina). Todos los derechos reservados.
          </div>
        </div>
      </section>

      <section class="card">
        <div class="hd">
          <h2>Curva + Resultados</h2>
          <div class="row tight">
            <button id="btnPNG">PNG</button>
            <button id="btnCSV" disabled>Download file</button>
          </div>
        </div>

        <div class="bd">
          <div class="canvasWrap">
            <canvas id="curve" width="1400" height="820"></canvas>
          </div>

          <div style="margin-top:12px" class="muted">Macro (estructura)</div>
          <div class="macroGrid">
            <div class="metric"><div class="k">V_center (km/s)</div><div class="v" id="macroVCenter">—</div></div>
            <div class="metric"><div class="k">V_edge (km/s)</div><div class="v" id="macroVEdge">—</div></div>
            <div class="metric"><div class="k">V_max (km/s)</div><div class="v" id="macroVMax">—</div></div>
            <div class="metric"><div class="k">R_center (kpc)</div><div class="v" id="macroRCenter">—</div></div>
            <div class="metric"><div class="k">R_edge (kpc)</div><div class="v" id="macroREdge">—</div></div>
            <div class="metric"><div class="k">slope_center (km/s/kpc)</div><div class="v" id="macroSlope">—</div></div>
          </div>

          <div style="margin-top:12px" class="muted">Tabla</div>
          <table>
            <thead><tr><th>Objeto</th><th>RMS (km/s)</th><th>Detalle</th></tr></thead>
            <tbody id="resultsBody">
              <tr><td class="mono">—</td><td>—</td><td class="muted">Esperando…</td></tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>
  </div>
</main>


<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="./app.js"></script>
</body>
</html>
